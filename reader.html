<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reader</title>
  <link rel="icon" type="image/png" href="important-img/icon.png">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="reader.css">
</head>
<body>

  <div class="gear-effect-container" id="gearContainer"></div>
  <div class="settings-toggle" id="settingsToggle">â–</div>
  <div class="overlay" id="menuOverlay"></div>

  <div class="settings-menu" id="settingsMenu">
    <h3>âš™ï¸ è®¾ç½®</h3>
    <div class="setting-section">
      <h4>ğŸ¨ çº¯è‰²èƒŒæ™¯</h4>
      <div class="setting-option" data-bg="default">é»˜è®¤æ·¡è“</div>
      <div class="setting-option" data-bg="lightblue">æµ…è“è‰²</div>
      <div class="setting-option" data-bg="white">çº¯ç™½</div>
      <div class="setting-option" data-bg="dark">æ·±ç°</div>
    </div>
    <div class="setting-section">
      <h4>ğŸ–¼ï¸ å›¾ç‰‡èƒŒæ™¯</h4>
      <div id="imageBgOptions"></div>
    </div>
  </div>

  <div class="layout">
    <div class="left-panel panel">
      <div class="avatar">
        <a href="important-img/avatar.png"><img src="important-img/avatar.png"></a>
      </div>
      <h1>Hello!</h1>
      <p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™ï½è¿™é‡Œè®°å½•ä¸€äº›æƒ³æ³•ã€é¡¹ç›®å’Œæ—¥å¸¸ã€‚</p>
      <div class="tags">
        <span class="tag">å‰ç«¯</span>
        <span class="tag">å¼‚æ˜Ÿæ¥å®¢</span>
        <span class="tag">å­¦ç”Ÿ</span>
        <span class="tag">çŒ«å¨˜</span>
      </div>
      <div class="btn-placeholder"><a href="https://github.com/yumiao-awa">æˆ‘çš„githubè´¦å·</a></div>
      <div class="btn-placeholder"><a href="https://github.com/yumiao-awa/myself">ç½‘é¡µæºä»£ç </a></div>
    </div>

    <div class="right-panel panel reader-panel">
      <h2 class="section-title">ğŸ“– é˜…è¯»å™¨</h2>
      <div id="reader-content" class="reader-content">
        <p>æ­£åœ¨åŠ è½½â€¦â€¦</p>
      </div>
    </div>
  </div>

  <script>
    // ===== å½©è›‹åˆ—è¡¨ï¼ˆç›´æ¥å†…åµŒï¼‰=====
    const easterEggs = [
      { key: 'secret', url: 'https://yumiao-awa.github.io/Client/book/yumiao' },
      { key: 'neko', url: 'img/neko.png' },
      { key: 'github', url: 'https://github.com/yumiao-awa' },
      { key: 'blog', url: 'index.html' },
      { key:"ä½•æ„å‘³",url:"reader?file=txt/hyw.txt"},
      { key:"code",url:"code"},
      { key:"æºä»£ç ",url:"code"}
    ];

    // ===== è·å– URL å‚æ•° =====
    function getUrlParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    // ===== åŠ è½½å†…å®¹ï¼ˆæ–‡æœ¬æˆ–å½©è›‹ï¼‰=====
    async function loadContent(filename) {
      const contentEl = document.getElementById('reader-content');

      if (!filename) {
        contentEl.innerHTML = '<p>âŒ æœªæŒ‡å®šæ–‡ä»¶ã€‚è¯·åœ¨ URL ä¸­æ·»åŠ  ?file=xxx.txt</p>';
        return;
      }

      // æ£€æŸ¥æ˜¯å¦ä¸ºå½©è›‹
      const egg = easterEggs.find(item => item.key === filename);
      if (egg && egg.url) {
        window.open(egg.url);
        contentEl.innerHTML = `<p>âœ¨ å½©è›‹å·²è§¦å‘ï¼æ­£åœ¨è·³è½¬â€¦â€¦</p>`;
        return;
      }

      // å¦åˆ™å½“ä½œæ™®é€šæ–‡æœ¬æ–‡ä»¶åŠ è½½
      try {
        const response = await fetch(filename);
        if (!response.ok) throw new Error('æ–‡ä»¶æœªæ‰¾åˆ°');
        const text = await response.text();
        const safeText = text
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        contentEl.innerHTML = `<pre>${safeText}</pre>`;
      } catch (err) {
        contentEl.innerHTML = `<p>âŒ åŠ è½½å¤±è´¥ï¼š${err.message}</p>`;
      }
    }

    // ===== é½¿è½®ç‚¹å‡»ç‰¹æ•ˆ =====
    function getGearColor() {
      const bg = window.getComputedStyle(document.body).backgroundColor;
      const match = bg.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
      if (!match) return '#2c3e50';
      const r = parseInt(match[1]), g = parseInt(match[2]), b = parseInt(match[3]);
      const brightness = (r * 299 + g * 587 + b * 114) / 1000;
      return brightness > 160 ? '#2c3e50' : '#ffffff';
    }

    document.addEventListener('click', function(e) {
      const gear = document.createElement('div');
      gear.className = 'gear-effect';
      gear.textContent = 'âš™';
      gear.style.color = getGearColor();
      gear.style.left = (e.clientX - 12) + 'px';
      gear.style.top = (e.clientY - 12) + 'px';
      document.getElementById('gearContainer').appendChild(gear);
      setTimeout(() => gear.remove(), 1000);
    });

    // ===== èœå• & èƒŒæ™¯è®¾ç½® =====
    const toggleBtn = document.getElementById('settingsToggle');
    const menu = document.getElementById('settingsMenu');
    const overlay = document.getElementById('menuOverlay');

    if (toggleBtn && menu && overlay) {
      toggleBtn.addEventListener('click', () => {
        menu.classList.add('open');
        overlay.classList.add('show');
      });
      overlay.addEventListener('click', () => {
        menu.classList.remove('open');
        overlay.classList.remove('show');
      });
    }

    const imageBackgrounds = [
      { name: 'æ˜Ÿç©º', path: 'https://images.unsplash.com/photo-1506318137071-a8e063b4bec0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80' },
      { name: 'æ£®æ—', path: 'https://images.unsplash.com/photo-1543512214-3070928057d1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80' },
      { name: 'ç”˜åŸ', path: 'img/neko.png' },
      { name: 'æµ·æ´‹', path: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80' },
    ];

    function applyBackground(bgType, value) {
      if (bgType === 'color') {
        document.body.style.background = value;
        document.body.style.backgroundSize = '';
      } else if (bgType === 'image') {
        document.body.style.background = `url(${value}) no-repeat center center fixed`;
        document.body.style.backgroundSize = 'cover';
      }
      localStorage.setItem('reader-bgType', bgType);
      localStorage.setItem('reader-bgValue', value);
    }

    function initBackground() {
      const savedType = localStorage.getItem('reader-bgType');
      const savedValue = localStorage.getItem('reader-bgValue');
      if (savedType && savedValue) {
        applyBackground(savedType, savedValue);
      }
    }

    function bindMenuEvents() {
      const bgMap = {
        default: '#f0f8ff',
        lightblue: '#e6f2ff',
        white: '#ffffff',
        dark: '#2c3e50'
      };

      document.querySelectorAll('.setting-option[data-bg]').forEach(opt => {
        opt.addEventListener('click', () => {
          const key = opt.getAttribute('data-bg');
          applyBackground('color', bgMap[key] || '#f0f8ff');
          menu.classList.remove('open');
          overlay.classList.remove('show');
        });
      });

      const imageBgOptions = document.getElementById('imageBgOptions');
      if (imageBgOptions) {
        imageBgOptions.innerHTML = '';
        imageBackgrounds.forEach(img => {
          const option = document.createElement('div');
          option.className = 'setting-option';
          option.innerHTML = `<span class="bg-preview" style="background-image: url(${img.path});"></span>${img.name}`;
          option.addEventListener('click', () => {
            applyBackground('image', img.path);
            menu.classList.remove('open');
            overlay.classList.remove('show');
          });
          imageBgOptions.appendChild(option);
        });
      }
    }

    // ===== åˆå§‹åŒ– =====
    document.addEventListener('DOMContentLoaded', () => {
      const file = getUrlParam('file');
      loadContent(file);       // ç«‹å³åŠ è½½ï¼Œä¸ç­‰å¾…ä»»ä½•å¼‚æ­¥æ“ä½œ
      bindMenuEvents();
      initBackground();
    });
  </script>
</body>
</html>
